<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Physics Arena</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body {
            margin: 0;
            background: #050510;
            color: #e0e0ff;
            display: grid;
            grid-template-columns: 22% 56% 22%;
            grid-template-rows: 65% 35%;
            grid-template-areas:
                "causal fourier embeddings"
                "robotics robotics robotics";
            height: 100vh;
        }
        #causal { grid-area: causal; border-right: 1px solid #222244; }
        #fourier { grid-area: fourier; border-left: 1px solid #222244; border-right: 1px solid #222244; position: relative; }
        #embeddings { grid-area: embeddings; border-left: 1px solid #222244; }
        #robotics { grid-area: robotics; border-top: 1px solid #222244; }
        .panel { width: 100%; height: 100%; }
        #fourier_controls {
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            padding: 6px;
            background: rgba(5, 5, 16, 0.85);
            font-size: 11px;
            border-radius: 4px;
        }
        #fourier_controls label { display: inline-block; width: 80px; }
        #fourier_controls input[type=range] { width: 110px; vertical-align: middle; }
        #fourier_controls span { display: inline-block; width: 40px; text-align: right; }
        #fourier_controls button {
            margin-left: 6px;
            padding: 2px 8px;
            font-size: 11px;
            background: #222244;
            color: #e0e0ff;
            border: 1px solid #444477;
            border-radius: 3px;
            cursor: pointer;
        }
        #fourier_controls button:hover {
            background: #333366;
        }
    </style>
</head>
<body>

<div id="causal" class="panel"></div>
<div id="fourier" class="panel">
    <div id="fourier_plot" style="width:100%;height:100%;"></div>
    <div id="fourier_controls">
        <div>
            <label>A₁ (sin x):</label>
            <input id="a1" type="range" min="0" max="200" value="100">
            <span id="a1_val">1.0</span>
        </div>
        <div>
            <label>A₂ (cos 2y):</label>
            <input id="a2" type="range" min="0" max="200" value="50">
            <span id="a2_val">0.5</span>
        </div>
        <div>
            <label>A₃ (sin(3x+y)):</label>
            <input id="a3" type="range" min="0" max="200" value="30">
            <span id="a3_val">0.3</span>
        </div>
        <div style="margin-top:4px;">
            <label>Animation:</label>
            <button id="anim_toggle">Start</button>
            <span id="anim_state" style="margin-left:8px;">stopped</span>
        </div>
    </div>
</div>
<div id="embeddings" class="panel"></div>
<div id="robotics" class="panel"></div>

<script>
/* -------------------------
   CAUSAL SET (LEFT PANEL)
------------------------- */
(function() {
    const nodes = [
        {id: 1, x: 0, y: 3},
        {id: 2, x: 2, y: 3},
        {id: 3, x: -1, y: 2},
        {id: 4, x: 1, y: 2},
        {id: 5, x: 3, y: 2},
        {id: 6, x: 0, y: 1},
        {id: 7, x: 2, y: 1},
        {id: 8, x: 1, y: 0}
    ];

    const edges = [
        [1,3], [1,4],
        [2,4], [2,5],
        [3,6],
        [4,6], [4,7],
        [5,7],
        [6,8],
        [7,8]
    ];

    const edgeTraces = edges.map(([a,b]) => {
        const A = nodes.find(n => n.id === a);
        const B = nodes.find(n => n.id === b);
        return {
            x: [A.x, B.x],
            y: [A.y, B.y],
            mode: "lines",
            line: {color: "#ffaa44", width: 2},
            hoverinfo: "none",
            showlegend: false
        };
    });

    const nodeTrace = {
        x: nodes.map(n => n.x),
        y: nodes.map(n => n.y),
        text: nodes.map(n => "E" + n.id),
        mode: "markers+text",
        textposition: "bottom center",
        marker: {size: 16, color: "#66ccff"},
        textfont: {color: "#ffffff"},
        hoverinfo: "text"
    };

    Plotly.newPlot("causal", [...edgeTraces, nodeTrace], {
        paper_bgcolor: "#050510",
        plot_bgcolor: "#050510",
        xaxis: {visible: false},
        yaxis: {visible: false},
        margin: {l: 0, r: 0, t: 30, b: 0},
        title: {text: "Causal Set", font: {color: "#e0e0ff"}}
    });
})();


/* -------------------------
   FOURIER SURFACE (CENTER)
   Multi-mode + sliders + animation
------------------------- */
(function() {
    const size = 50;
    const x = [];
    const y = [];
    for (let i = 0; i < size; i++) {
        x.push(-2 * Math.PI + (4 * Math.PI * i / (size - 1)));
        y.push(-2 * Math.PI + (4 * Math.PI * i / (size - 1)));
    }

    let A1 = 1.0;   // sin(x)
    let A2 = 0.5;   // cos(2y)
    let A3 = 0.3;   // sin(3x + y)
    let t = 0.0;
    let animating = false;
    let animHandle = null;

    function computeZ() {
        const z = [];
        for (let i = 0; i < size; i++) {
            const row = [];
            for (let j = 0; j < size; j++) {
                const xi = x[i];
                const yj = y[j];
                const zval =
                    A1 * Math.sin(xi + 0.5 * t) +
                    A2 * Math.cos(2 * yj - 0.3 * t) +
                    A3 * Math.sin(3 * xi + yj + 0.7 * t);
                row.push(zval);
            }
            z.push(row);
        }
        return z;
    }

    function updateSurface(fullRedraw=false) {
        const z = computeZ();
        if (fullRedraw) {
            Plotly.newPlot("fourier_plot", [{
                z: z,
                x: x,
                y: y,
                type: "surface",
                colorscale: "Viridis",
                showscale: false
            }], {
                paper_bgcolor: "#050510",
                scene: {
                    xaxis: {color: "#ccccff"},
                    yaxis: {color: "#ccccff"},
                    zaxis: {color: "#ccccff"}
                },
                margin: {l: 0, r: 0, t: 30, b: 0},
                title: {text: "Fourier Energy Field", font: {color: "#e0e0ff"}}
            });
        } else {
            Plotly.update("fourier_plot", {z: [z]}, {}, [0]);
        }
    }

    function step() {
        if (!animating) return;
        t += 0.06;
        updateSurface(false);
        animHandle = requestAnimationFrame(step);
    }

    // Initial draw
    updateSurface(true);

    // Hook sliders
    const a1Slider = document.getElementById("a1");
    const a2Slider = document.getElementById("a2");
    const a3Slider = document.getElementById("a3");
    const a1Val = document.getElementById("a1_val");
    const a2Val = document.getElementById("a2_val");
    const a3Val = document.getElementById("a3_val");
    const animToggle = document.getElementById("anim_toggle");
    const animState = document.getElementById("anim_state");

    function sliderToAmp(slider) {
        return parseInt(slider.value, 10) / 100.0;
    }

    a1Slider.addEventListener("input", () => {
        A1 = sliderToAmp(a1Slider);
        a1Val.textContent = A1.toFixed(2);
        updateSurface(false);
    });

    a2Slider.addEventListener("input", () => {
        A2 = sliderToAmp(a2Slider);
        a2Val.textContent = A2.toFixed(2);
        updateSurface(false);
    });

    a3Slider.addEventListener("input", () => {
        A3 = sliderToAmp(a3Slider);
        a3Val.textContent = A3.toFixed(2);
        updateSurface(false);
    });

    animToggle.addEventListener("click", () => {
        animating = !animating;
        if (animating) {
            animToggle.textContent = "Stop";
            animState.textContent = "running";
            if (!animHandle) {
                animHandle = requestAnimationFrame(step);
            }
        } else {
            animToggle.textContent = "Start";
            animState.textContent = "stopped";
            if (animHandle) {
                cancelAnimationFrame(animHandle);
                animHandle = null;
            }
        }
    });

    // Initialize labels
    a1Val.textContent = A1.toFixed(2);
    a2Val.textContent = A2.toFixed(2);
    a3Val.textContent = A3.toFixed(2);
})();


/* -------------------------
   EMBEDDINGS (RIGHT PANEL)
------------------------- */
(function() {
    function generateClusters(numClusters = 3, pointsPerCluster = 40) {
        const clusters = [];
        const centers = [];

        for (let i = 0; i < numClusters; i++) {
            const cx = Math.random() * 8 - 4;
            const cy = Math.random() * 8 - 4;
            centers.push({x: cx, y: cy});

            for (let j = 0; j < pointsPerCluster; j++) {
                clusters.push({
                    x: cx + (Math.random() - 0.5) * 1.2,
                    y: cy + (Math.random() - 0.5) * 1.2,
                    cluster: i
                });
            }
        }
        return {clusters, centers};
    }

    const {clusters, centers} = generateClusters();

    const clusterTrace = {
        x: clusters.map(p => p.x),
        y: clusters.map(p => p.y),
        mode: "markers",
        marker: {
            size: 7,
            color: clusters.map(p => p.cluster),
            colorscale: "Viridis"
        }
    };

    const centerTrace = {
        x: centers.map(c => c.x),
        y: centers.map(c => c.y),
        mode: "markers+text",
        text: centers.map((c, i) => "C" + i),
        textposition: "top center",
        marker: {size: 14, color: "white", symbol: "x"}
    };

    Plotly.newPlot("embeddings", [clusterTrace, centerTrace], {
        paper_bgcolor: "#050510",
        plot_bgcolor: "#050510",
        xaxis: {color: "#ccccff"},
        yaxis: {color: "#ccccff"},
        margin: {l: 30, r: 20, t: 30, b: 30},
        title: {text: "Embedding Space", font: {color: "#e0e0ff"}}
    });
})();


/* -------------------------
   ROBOTICS (BOTTOM PANEL)
------------------------- */
(function() {
    function forwardKinematics(theta1, theta2, L1=1.0, L2=0.7) {
        const t1 = theta1 * Math.PI / 180;
        const t2 = theta2 * Math.PI / 180;

        const x1 = L1 * Math.cos(t1);
        const y1 = L1 * Math.sin(t1);

        const x2 = x1 + L2 * Math.cos(t1 + t2);
        const y2 = y1 + L2 * Math.sin(t1 + t2);

        return [[0, x1, x2], [0, y1, y2]];
    }

    const [xs, ys] = forwardKinematics(40, 30);

    Plotly.newPlot("robotics", [{
        x: xs,
        y: ys,
        mode: "lines+markers",
        line: {color: "cyan", width: 5},
        marker: {size: 12, color: ["white", "magenta", "red"]}
    }], {
        paper_bgcolor: "#050510",
        plot_bgcolor: "#050510",
        xaxis: {range: [-2, 2], color: "#ccccff"},
        yaxis: {range: [-2, 2], color: "#ccccff"},
        margin: {l: 40, r: 20, t: 20, b: 40},
        title: {text: "Robotics Arm", font: {color: "#e0e0ff"}}
    });
})();
</script>

</body>
</html>